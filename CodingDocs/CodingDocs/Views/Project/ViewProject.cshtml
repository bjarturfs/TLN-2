@model CodingDocs.Models.ViewModels.ViewProjectViewModel

@{
    ViewBag.Title = Model.Name;
}

<h2>@Model.Name</h2>

<div class="container-fluid">
    <h3>Files</h3>
    <div class="row">
        <div class="col-sm-3 col-lg-2">
            <nav class="navbar navbar-default navbar-fixed-side">
                @foreach (var file in Model.Files)
                {
                    var serializer = new System.Web.Script.Serialization.JavaScriptSerializer();
                    var jsonFile = serializer.Serialize(file);

                    <button data-json="@jsonFile">@file.Name</button>
                    <a class="glyphicon glyphicon-file">@(file.Name + "." + file.Type + " ")</a>@Html.ActionLink("Delete", "DeleteFile", new { id = file.ID }, new { style = "color:red" })<br />
                }
            </nav>
        </div>
    </div>
</div>

@using (Html.BeginForm("SaveFile", "Project", FormMethod.Post))
{
    @Html.Hidden("Content", null, new { @id = "hidden_content" })
    @Html.Hidden("Id", null, new { @id = "hidden_id" })
    <input type="submit" value="Save" id="save_button" />
}

<label class="folderName">@Html.ActionLink("New File", "CreateFile", new { id = Model.ID })</label>

<br />

@Html.ActionLink("Share Project", "InviteUser", new { id = Model.ID })

<h3>Project Owner</h3>
<div> @Model.OwnerName</div>

@if(Model.UserName.Any())
{
    <h3>Users In Project</h3>
}
<ul>
    @foreach (var user in Model.UserName)
    {
        <li>@(user + " ")</li>
    }
</ul>

<div id="panel_body">
    <div id="editor"></div>
</div>

@section scripts{
    <script src="~/Ace/src/ace.js" type="text/javascript" charset="utf-8"></script>
    <script>
        $("#panel_body").hide();
        $("#save_button").hide();
        var editor = ace.edit("editor");
        editor.setTheme("~/Ace/src/theme-monokai.js");
        editor.getSession().setMode("~/Ace/src/mode-javascript.js");
        var current;

        $("button").click(function () {
            var jsonFile = JSON.parse($(this).attr('data-json'));
            editor.setValue(jsonFile.Content);
            current = jsonFile.ID;
            $("#panel_body").show();
            $("#save_button").show();
        })

        $("form").submit(function () {
            $("#hidden_content").val(editor.getSession().getValue());
            $("#hidden_id").val(current);
        })
    </script>
}
